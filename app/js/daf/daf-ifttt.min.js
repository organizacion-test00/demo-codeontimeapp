/*!
* Data Aquarium Framework - If This Then That + Kiosk UI
* Copyright 2021-2020 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function b(n,t,i){var r=n.id;return r||(r=n.id="flow"+ef++),t=r+"_"+t,arguments.length<3?pr[t]:pr[t]=i}function kr(n,t,i){var r=b(n,t);return r==null&&(r=i,b(n,t,r)),r}function g(t,i,r){n.notify(arguments.length>1?{text:t,force:i,duration:r}:t)}function nt(){return n.busy()||n.isInTransition()}function dr(){return n.activePage()||$()}function fi(){return!1}function lt(n){s.barcode(":always",n)}function kt(){return u&&!u.nextAll(".ui-page-active").length}function tt(i){if(arguments.length)i?(lt(!u||kt()),t&&t.input.barcode&&$(document.activeElement).blur(),s.valid()&&(ri||(ri=ut("ui.transitions.style")),ut("ui.transitions.style","none"),y.addClass("app-ui-automation"),dr().addClass("app-ui-automation-root"))):(lt(kt()),$(".app-ui-automation,.app-ui-automation-root").removeClass("app-ui-automation app-ui-automation-root"),s.barcode(":peek")==null&&n.resetUI(),ut("ui.transitions.style",ri));else return y.is(".app-ui-automation")}function dt(n){n===!0?(y.addClass("app-ui-automation-system"),ut("ui.transitions.style",ri)):(y.removeClass("app-ui-automation-system"),ut("ui.transitions.style","none"))}function gr(){dt();u&&lt(!0)}function v(n){return n="ui.automation."+n,ut.apply(this,arguments)}function at(n){n&&e.error(n);d&&d.resolve()}function nu(){d&&d.reject()}function ei(n){return JSON.stringify(n).replace(/","/g,'", "')}function tu(n){return new RegExp(RegExp.escape(n).replace(/\\\+/g,".+?"),"i")}function h(n,t,i){var o=t&&t.length,u,e,r,f;if(n&&n._extended)return n;if(o===1&&typeof n=="object"&&!("selector"in n)){n._extended||(n._extended={});for(e in n)ki.indexOf(e)<0&&(n.selector=e,u=n[e],u instanceof it&&(n[e]=u=u.unwrap()),n._extended.mapped||(n.value=u,n._extended.mapped=!0))}return n==null&&(n=""),typeof n=="string"&&(n={selector:n,_extended:{}}),r=n.regex,r||(r=n.selector,r==null&&(r=""),r instanceof RegExp||(r=r.toString(),r!=null&&r.match(/^@/)?(r=r.substring(1),n.identifier=r):r=tu(r)),n.regex=r),t&&(o>1&&(u=t[1],u instanceof it&&(u=t[1]=u.unwrap()),n.value=u,i===2&&(n.in=u)),o>2&&(n.in=t[2])),n.in&&(f={selector:n.in},f=h(f),f.identifier?n.inIdentifier=f.identifier:n.inRegex=f.regex),n}function nr(n){var i=n&&n._survey,t=i&&i.context;return t&&typeof t=="object"&&"model"in t&&"search"in t&&(n=r.find(t.id)),n}function tr(){var t=u&&!tt()?wt(u.prevAll(".ui-page-active,.ui-page").first().attr("id")):n.dataView(),f,i;return t=u&&!tt()?u.prevAll(".ui-page-active").length?n.dataView():wt(u.prevAll(".ui-page:first").attr("id")):n.dataView(),t||(f=$("#Main .app-echo:first"),f.length&&(t=wt(f.data("for")))),t||(i=n.pageInfo(wr),$app.survey({controller:i.id,id:i.id,show:!1,questions:[{name:"text"}],cancel:!1}),t=i.dataView=r.findDataView(i.id),i.page||(i.page=$(".ui-page-active")),i.initialized=!1,t&&n.pageInit(t._id)),t}function gt(n){var t=tr(),i;return t&&(t=nr(t),n.in&&(n.inIdentifier?i=t.findField(n.inIdentifier):t._allFields.every(function(t){return t.HeaderText.match(n.inRegex)&&(i=t),!i}),t=i?r.find(i._dataViewId):null)),t}function iu(n,t,i,r){!n._allFields||n._busy()||fi()?setTimeout(iu,32,n,t,i,r):ru(n,t,i,r)}function ru(n,i,r,u){if(r)u(n,i)!==!1&&(t.error?i.reject():setTimeout(e._wait,ft,i));else{var f=u(n,i);f&&f.then||(f?i.resolve(f):i.reject())}}function ir(n,t,i,u){var f=tr(),o,e;return f&&(f=nr(f),n.in&&(n.inIdentifier?e=f.findField(n.inIdentifier):f._allFields.every(function(t){return t.HeaderText.match(n.inRegex)&&(e=t),!e}),e?(f=r.find(e._dataViewId),o=!f._allFields||f._busy()):f=null)),u&&(o?(s.focus({field:e}),iu(f,t,i,u)):ru(f,t,i,u)),f}function k(n,t){var i,r=n.identifier;return t||(t=gt(n)),t&&(r?i=t.findField(r):t._allFields.every(function(t){return t.HeaderText.match(n.regex)&&(i=t),!i})),i}function uu(n,t){var u={},i,r,f=[];if(n._extended.mapped)for(r in n)ki.indexOf(r)<0&&(i=k(h({selector:r,"in":n.in})),i?u[i.Name]=n[r]:f.push(r));else i=k(n),i?u[i.Name]=n.value:f.push(n.selector);return f.length&&(e.error(t+': "'+f.join('", "')+'" not found.'),at(!1),u=null),u}function rr(t,i,r){var u,o=n.contextScope(),e=i.identifier,f;return t&&(f=!t.get_isForm(),r||(r=[]),r.length||(n.contextScope(t),n.navContext(r),n.contextScope(o)),r.every(function(n){var r=n.text;return(e==null||n.path!==e)&&(!r||n.system&&!i.system||n.command==="New"&&f&&(n.argument===t._viewId||!n.argument)||n.command==="Edit"&&f&&(n.argument===t._viewId||!n.argument)||!r.match(i.regex))||(u=n),!u})),u}function fu(n,t,i,r){var u=[],e=[],o,s;if(r.method==="filter"){u=null;for(o in i)s=n.findField(o),s&&e.push(s.Name+":=%js%"+JSON.stringify(i[o]))}else n._allFields.forEach(function(n){n.IsPrimaryKey&&(u.push(t[n.Name]),e.push(n.Name+":=%js%"+JSON.stringify(t[n.Name])))});r.filter&&!f&&(n._syncFilter=!0,n.set_filter(e));n.sync(u);n._syncFilter=!1}function it(n){this._deferred=$.Deferred();this._pending=n?n._pending.slice():[]}function hf(){var l=$app.userName(),i=c("app-avatar").attr("data-title",l).appendTo(u),e=Web.Menu.currentNode,a=v("kiosk.copyright"),p,s,h,t;for(p=c("app-logo").appendTo(u).html(n.appName()),e&&c("app-page-title").appendTo(p.attr("data-title",e.description)).text(e.title),c('app-btn-menu ui-btn ui-btn-icon-notext ui-btn-left ui-icon-bars"').appendTo(u).attr("data-title",ot.Menu),s=c('app-btn-context ui-btn ui-btn-icon-notext ui-btn-left ui-icon-bars"').appendTo(u).attr("data-title",ot.More),r.AccountManager.avatar(l,br("app-icon-avatar").text(n.initials(r.userName())).appendTo(i)),r.userName()?s=i:(i.hide(),y.data("public")||c("app-login ui-btn").appendTo(u).attr("data-title",Web.MembershipResources.Bar.LoginLink)),f=o("app-display").appendTo(u),a!==!1&&o("app-copyright app-acc-footer").appendTo(u.addClass("app-has-copyright")).html(a||$("#PageFooterBar,footer small").html()),h=u.width()-s.offset().left-28,t=1;t<3;t++)h+=50,c("ui-btn ui-btn-icon-notext ui-btn-left app-btn app-btn"+t,sf("i","app-icon material-icon")).css("right",h).appendTo(u).hide()}function ni(n){if(f)if(n===!0){var i=f.data("config"),t;navigator.userAgent.match(/Edge/)&&(t=$(".app-kiosk > .ui-btn,.app-kiosk > .app-logo").hide());bu();f.empty();er(i);t&&t.show()}else clearTimeout(lr),lr=setTimeout(ni,200,!0)}function ti(n){if(f)if(n){var t=n.dataView._id,i=st.indexOf(t);i===-1&&st.push(n.dataView._id);setTimeout(ti)}else nt()?setTimeout(ti,ft):st.length&&pu()}function cf(n){return'&nbsp;<i class="app-icon material-icon" aria-hidden="true">expand_'+(n?"less":"more")+"<\/i >"}function lf(){return 8}function af(n){return n.toString()}function vf(){return this._config.columns||8}function oi(n,t){n&&(n._dataView=t,n.val=t?yf:null)}function yf(n){var r=this,u=r._dataView,t,i;return n&&(n.match(/^@/)?n=n.substring(1):t=n instanceof RegExp?n:tu(n)),u._allFields.every(function(r){return(t&&r.HeaderText.match(t)||r.Name===n)&&(i=r.Name),!i}),r[i]}function eu(n){var t=n._inDataView;return n._hasFields&&!t.get_isForm()&&n._count>1}function ou(n){return{width:n[0].offsetWidth-n[0].clientWidth+1,height:n[0].offsetHeight-n[0].clientHeight+1}}function ur(n,t){var r=t==="fill",i;return t!=null&&(i=o("app-container-content").attr("tabindex",0).appendTo(n.toggleClass("app-container-autosize",r)),i.css({"margin-right":i[0].clientWidth-i[0].offsetWidth-1-parseInt(n.css("paddingRight")),height:!r&&t!==!1?t:null})),i}function fr(n){var t=n.perform;return"barcode"in n||t&&(typeof t=="function"||t.show||t.hide||typeof t.pick=="string")}function pf(n){var i=[],t=v("numPad.buttons"),u=n.label;return t||(t=standardNumPadButtons,n.compact&&(t=JSON.parse(JSON.stringify(t)),t[1][3]=t[3][2],t[2][3]=t[4][0],t[2][3].tall=!0,t.splice(t.length-1))),i.push('<div class="app-numpad">'),u&&i.push('<div class="app-label">'+r.htmlEncode(u)+"<\/div>"),i.push('<div class="app-text app-null"><span class="app-value"><\/span><i class="app-icon material-icon" aria-hidden="true" title="'+ot.ClearText+'" data-key="Clear">clear<\/i><\/div>'),t.forEach(function(n){var t=0,r;n.forEach(function(n){t+=n.width||1;n.tall&&(r=!0)});i.push('<div class="app-row'+(r?" app-tall":"")+'">');n.forEach(function(n){var f=n.icon,e=n.font,r=n.key,u=n.test;typeof r=="function"&&(r=r());u&&di.push(u);i.push('<span class="app-btn app-feedback'+(n.accent?" app-accent":"")+(n.dark?" app-dark":"")+(n.tall?" app-tall":"")+'" style="width:'+(n.width||1)/t*100+"%;"+(e?"font-size:"+e+";":"")+'" data-key="'+r+'"'+(u?' data-test="'+(di.length-1)+'"':"")+">");i.push(f?'<i class="app-icon material-icon" aria-hidden="true">'+f+"<\/i>":n.text||r);i.push("<\/span>")});i.push("<\/div>")}),i.push("<\/div>"),i.join("")}function su(n,t,i,u,f){function g(){if(b){var n=e.parent(),u,t=n.outerHeight(),h=t<=ut&&!r.agent.ie,f=n.find("h1>.material-icon,h2>.material-icon,h3>.material-icon,h4>.material-icon,h5>.material-icon,h6>.material-icon").first(),s=d.icon,i;h&&(n.is(".app-align-top,.app-align-bottom")||n.addClass("app-align-center"),t=ut-(t-e.outerHeight(!0)),n.height(t));b=null;s!==!1&&(i=Math.min(n.width(),n.height()),typeof s=="string"?br("material-icon").text(s).insertBefore(e).css({transform:"scale("+i/24+")",right:i/2}):f.length&&(f=f.clone().insertBefore(e).css("transform","scale("+i*.6/24+")")));h&&d.sticky&&(u=o("app-sticky-hero-container").insertBefore(n),n.appendTo(u).addClass("app-spacing-none app-hero-sticky").find(".app-hero-content").appendTo(o("app-hero").toggleClass("app-spacing-none",d.spacing===!1).height(t).appendTo(u)))}}var nt;t.data("created")||(t.data("created",new Date),n.forEach(function(n){delete n._lastResult}));rt(n,function(n){hu(n);rt(n,function(n){hu(n)},!1)},!1);var tt=tr(),l=i,s,y,p,it,a,w,e,b,d,ut=t.height();sr(n,t);n.forEach(function(t,ut){var pt=t.in,at,ht=t.background,fi=ht&&ht.fluid,bi=t.fluid,ki=t.jumbo,et=t.hero,ni,wt,kt,ti,oi,gt,ri,si,hi,ci,ct,li,ai;if(et!=null&&(et=typeof et=="object"?et:{id:et},"id"in et||(et.id=!0)),pt?(pt=k(h({"in":pt})),pt?(at=pt._dataView,t._inDataView=at):nt='Invalid DataView field "'+t.in+'".'):(at=tt,t._inDataView=tt),!t.hidden){t._count=t.count||10;t._newRow&&(y=fi?o("app-row-container").appendTo(i):i,s=o("app-row").appendTo(y),et?(ni=et.id,wt=et.background,(ni===!0||ni!==b)&&(g(),d=et,b=ni,e=o("app-hero-content").appendTo(o("app-hero").toggleClass("app-spacing-none",et.spacing===!1).css("background-color",wt?wt.color:null).appendTo(i)),et.align==="top"&&e.parent().addClass("app-align-top"),et.align==="bottom"&&e.parent().addClass("app-align-bottom")),s.appendTo(e),y=e,wt&&e.parent().addClass("app-has-background").toggleClass("app-background-accent",wt.accent===!0)):g(),f&&!bi&&s.css({maxWidth:f,minWidth:f,marginLeft:"auto",marginRight:"auto"}),ki&&(fi&&!et?y:s).addClass("app-jumbo").toggleClass("app-spacing-none",t.spacing===!1),ht&&(fi&&!et?y:s).addClass("app-has-background").toggleClass("app-background-accent",ht.accent===!0).css("background-color",ht.color));t._newCol&&(l=o("app-column").appendTo(s),kt=t._width,t.isContent&&f&&kt<1&&t._newRow&&(ut===n.length-1||n[ut+1]._newRow)?(ti=f*kt,t.fluid?vt(s,kt).css({marginLeft:"auto",marginRight:"auto"}):s.css({width:ti,minWidth:ti,maxWidth:ti}),vt(l,1)):vt(l,kt),!t._newRow&&ht&&l.addClass("app-has-background").toggleClass("app-background-accent",ht.accent===!0).css("background-color",ht.color));var yt=t.append?l.find(".app-container:last"):null,ft=yt?yt.length?yt:l:o("app-container").attr("data-index",ut).appendTo(l).data(t).toggleClass("app-spacing-none",t.spacing===!1),st,dt,lt=t.tab,yi=lt||t.label,ii,ei=t.height;if(t.readOnly&&!yt&&ft.attr("data-read-only","true"),lt?p&&(dt=p):(p=null,a=null),yi!=null&&(dt||(dt=o("app-header").appendTo(ft)),lt!=null&&lt===it&&a?(ii=a,w=a.data("tab")):(ii=o("app-text").text(yi).data("config",t).appendTo(dt),lt!=null&&(w=[],a=ii.data("tab",w))),lt!=null&&(it=lt,p=dt.addClass("app-tabset"),a=ii,w.push(ft))),at)if(oi=[],rt(t,function(n,i){var e=n.type,r,u,f;n.expression?(t._hasFields=!0,u=!0):fr(n)||(i==="numpad"?f=pf(n):i==="#"?("tall"in n||(n.tall=gt?gt.tall:!0),n.field={Name:"#",HeaderText:"#",Type:"Int32",_config:n,format:af,toColumns:vf},u=!0):i===">"?(n.tall=gt?gt.tall:!0,n.field={Name:">",Type:"Boolean",HtmlEncode:!1,_config:n,format:cf,toColumns:lf},n.label=!1,u=!0):(r=e==="field"||!e?k(h(n.clone||i),at):null,r&&(n.field=at._allFields[r.AliasIndex],t._hasFields=!0,u=!0)));n.dense&&(n.density="condensed");n._label=n.label!=null?n.label:r?r.HeaderText:i;oi.push({html:f?f:'<div data-type="'+(u?"field":"button")+'" data-name="'+i+'"'+(r?' data-field="'+r.Name+'"':"")+">"+(u?bt("app-label")+bt("app-value"):bt("app-button app-feedback",bt("app-text")))+"<\/div>",obj:n});gt=n}),t._propCount)t._items=oi,eu(t)?(ri=0,si=[],rt(t,function(n,i,r){var u=n.field;if((!n.flow||!r&&n.flow==="row")&&u)n._grid=!0,i===">"&&(t.expand=!0,t._expanded=kr(t,"expanded",{})),si.push(n),hi=u.toColumns(),n._columns=hi,ri+=hi;else return!1}),ri&&(ci=o("app-row-header").appendTo(ft),si.forEach(function(n){var t=n.field,i=n._label;n._width=n._columns/ri;c("app-text").appendTo(vt(c("app-column-header"),n._width).appendTo(ci).attr("data-name",t.Name).attr("data-type",t.Type).toggleClass("app-field-type-numeric",t.Type.match(r._numericTypeRegex)!=null)).text(i!==!1?i:"")})),sr(t,ci||ft),ur(ft,ei||!1),t.letters&&o("app-letters").data("config",t).appendTo(ft.addClass("app-has-letters"))):(ei!=null?st=ur(ft,ei):(st=ft,yt&&(st=ft.find(".app-container-content"),st.length||(st=ft))),sr(t,st),cu(t,st));else if(yt&&(st=ft.find(".app-container-content"),st.length&&(ft=st),ft=o().appendTo(ft)),t.isContent)if(ft=ur(ft,t.height)||ft,ct=t.as,wf(t),ft.css({color:t.color,"text-align":t.align}),ct){typeof ct=="string"&&ct.match(/c#|csharp|vb|visualbasic|html|javascript|json/i)&&(ct={code:ct});for(ai in ct)li=r.display.as[ai],li&&li.render(t,ct[ai],ft)}else $(t.content).appendTo(ft);else{var vi=t.image,ot=t.content,ui=vi!=null||ot!=null?!1:t.gapColor||v("kiosk.gapColor"),di=ui!==!1&&t.gapAccent,pi=t.dense?"condensed":t.density,wi=t._gap=ft.addClass("app-gap").toggleClass("app-accent",t.gapAccent===!0).toggleClass("app-gap-bkg",ui===!0).css({height:vi||ot?"":t._vertGap?"100%":or(t),"background-color":di||ui===!1?null:t.gapColor||ui});vi?ot=$("<img/>").appendTo(wi).attr("src",r.resolveClientUrl(t.image)):ot!=null&&(ot.match(/^\s*<\w+/)||(ot='<div class="app-html">'+ot+"<\/div>"),ot=$(ot).appendTo(wi),parseInt(ot.css("font-size"))||ot.addClass("app-html"),pi&&ot.addClass("app-density-"+pi));ot&&(u||(u=ou(i)),ot.css({"max-width":t.fluid?null:ft.width(),"max-height":i.height()-u.height}))}return!nt}});g()}function wf(n){var t=n.content,i=n.icon,u,f,e,o,r;if(!n._parsed){if(n._parsed=!0,i&&(typeof i=="string"&&(i={header:i}),typeof i=="object"&&(i.header&&(t=t.replace(/(<h1.*?>)/i,'$1<i class="material-icon">'+i.header+"<\/i>")),i.subheader&&(t=t.replace(/(<h[2-6].*?>)/i,'$1<i class="material-icon">'+i.subheader+"<\/i>")))),u=t.match(/<code>([\s\S]+?)<\/code>/),u){for(t=t.substring(0,u.index)+"<code>"+u[1].trim()+"<\/code>"+t.substring(u.index+u[0].length),f=[],e=0,o=/<h(\d)>([\s\S]+?)<\/h\d>/gi,r=o.exec(t);r;)f.push(t.substring(e,r.index)),e=r.index+r[0].length,n["_header"+r[1]]=r[2],r=o.exec(t);f.push(t.substring(e));t=f.join("").trim()}n.content=t}return t}function er(t){var h,c,r,i,e,s;if(!arguments.length||typeof t!="string"&&!t.length)return"[Invalid display]";for(f.data("config")!==t&&f.removeData("created"),f.data("config",t),l=o("app-display-content app-display-flow").attr("tabindex",0).appendTo(f),typeof t=="string"?t={other:t}:Array.isArray(t)&&(t={other:t}),f.css({width:"",height:"",left:"","margin-left":"",display:""}),c=n.toWidth(f.width()),r=p.indexOf(c),et=r;r>=0;)if(i=t[p[r]],i)break;else i=null,r--;return i||(i=t.other),e=Math.min(Math.max(u.width(),n.toWidth(c)),v("kiosk.maxWidth")||n.toWidth("xxl")),s=ou(l),f.css({width:e,height:f.height(),left:"50%","margin-left":-e/2+1}),l.css("width",e+s.width),l.css("height",f.height()+s.height),typeof i=="string"?o("app-content app-text").appendTo(l).html(i):h=su(i,f,l,s),h||(hr(),st.splice(0),pu(!1),f.find(".app-tabset .app-text:first").each(function(){var n=$(this),t=n.parent().find(".app-text"),i=kr(n.data("config"),"selectedTab",0);$(t[i<t.length?i:0]).trigger("vclick")}),si(),ci()),h}function si(n,t,i){n||(n=f);t||(t=l);var o=t.find(".app-container-autosize:not(.app-hidden)"),r,u,e,s=96;o.length&&o.each(function(){var f=$(this),o=f.show().find(".app-container-content"),c,l,a,v,h;o.data("sized")&&!i||o.is(".app-hidden")||(e=o.height("").is(":empty"),e&&(f.data("altered")||f.data("altered",!0).css({"padding-top":0,"padding-bottom":0}),f.show()),r==null&&(r=n.offset().top+n.height(),u=t.children().last()),o.data("sized",!0),c=f.parent(),l=c.children().filter(":visible").last(),a=c.offset().top+c.height()-(l.offset().top+l.outerHeight(!0)),v=r-(u.offset().top+u.outerHeight(!0)),h=o.height()+v+a,e&&(s=-1,h=Math.max(h,f.height(),0),h?f.show():f.hide()),h>s&&o.height(h))})}function hu(n){var i=n.alter,e=i,r,h,t,o,l,a,s,u,c,y=["_lastResult","_parsed","_header1","_header2"],v=[];for(t in n)t.match(/^_/)&&y.indexOf(t)<0&&v.push(t);if(v.forEach(function(t){delete n[t]}),i){s=e.remove||{};for(t in s)delete n[t];u=e.restore||{};for(t in u)n[t]=u[t];r=i.portrait;r&&f.width()<f.height()?i=r:(r=i.landscape,r&&f.width()>f.height()&&(i=r));for(t in i)if(o=t.match(uf),o&&(l=p.indexOf(o[1]||p[0]),a=p.indexOf(o[3]||p[p.length-1]),l<=et&&et<=a)){h=i[t];for(t in h)t in n?u[t]=n[t]:s[t]=!0,c=h[t],c==null?delete n[t]:n[t]=c;e.remove=s;e.restore=u;break}}}function or(n){var t=n.gapSize,i=t!=null?t:v("kiosk.gapSize");return i==null?f?12:16:i}function ii(n){return!n._propCount&&n.content==null&&n.image==null}function sr(n,t){var f=[],r,u,o=t.width(),i,e;rt(n,function(t){var s=Array.isArray(n)&&typeof n=="object",o;s&&rt(t);o=t.flow;t._grid||(o!=="row"&&r?o==="column"&&(e=!0,u=[],r.push(u),ii(t)&&s&&(t.width==null&&(t.width=or(t)),t._vertGap=!0)):(s&&(o==="column"||o==="row"&&(!i||i.flow==="row"&&ii(i)))&&ii(t)&&(t.width==null?t.width=or(t):t._keepWidth=!0,t._vertGap=!0),r=[],u=[],f.push(r),r.push(u)),u.push(t),!o&&t._propCount&&i&&ii(i)&&i._vertGap&&(i._keepWidth&&delete i.width,delete i._vertGap));i=t});f.forEach(function(n){var r=0,i=0,t=n[0][0];n.length===1&&n[0].length===1&&(ii(t)||!e)?(delete t._vertGap,t._keepWidth||t.isContent||delete t.width,t._width=1,t._newCol=!0,t._newRow=!0):n.forEach(function(t,u){var e=t[0].width,s,h;e!=null&&e!=="auto"?(typeof e=="string"&&(e.match(/%$/)?e=parseFloat(e)/100:e.match(/^\d+x$/)?(pt||(s=$('<div class="app-container"><div data-type="button"><div class="app-button app-no-text"><\/div><\/div><\/div>').appendTo(l),h=s.find(".app-button"),pt={w:h.width(),g:parseInt(h.css("margin-left"))},s.remove()),e=parseInt(e)*(pt.w+pt.g)+pt.g):e=parseInt(e)),t[0]._width=e=e<=1&&t[0].width!==1?e:e/o,r+=e):(i++,t[0]._width=null);(n.length>1||f.length>1)&&(u||(t[0]._newRow=!0),t[0]._newCol=!0)});i&&n.forEach(function(n){n[0]._width==null&&(n[0]._width=(1-r)/i)})})}function vt(n,t){return t=t!=null?t*100+"%":"",n.toggleClass("app-full-width",t==="100%"),n.css({width:t,minWidth:t,maxWidth:t})}function hi(n,t){return typeof n=="function"&&(n=n(t)),n}function cu(n,t){var s=n._items,f=t,i=0,u,h=0,e;s.forEach(function(c){var l=c.obj,y=c.html,a,p=l._grid,v=l.darkest?.75:l.dark,k=l._width,w=l._newRow,b=0;if((w||!u&&p)&&(e=!1,f=u=o("app-row").toggleClass("app-collapsed",n.expand&&h>0).appendTo(t),w&&i--)){while(i>=0)b+=s[i--].obj._width;u.css("margin-left",b*100+"%")}l.field&&!e&&(e=!0,h++);l._newCol&&(f=vt(o("app-column"),k).appendTo(u||t));(p||l._label===!1)&&(y=y.replace(bt("app-label"),""));a=l.item=$(y).appendTo(f);p&&(a.toggleClass("app-field-type-numeric",l.field.Type.match(r._numericTypeRegex)!=null),l.tall&&i++);v!=null&&(v===!0&&(v=.5),wu(a.find(".app-button"),1-v));fr(l)&&a.find(".app-button").data("obj",l)})}function rt(n,t,i){var u,r,e,f=0;for(u in n)if(ff.indexOf(u)===-1&&!u.match(/^_/)&&u!=="alter"&&(r=n[u],typeof r=="function"&&(r=n[u]={expression:r}),r!=null&&typeof r=="object"&&(!r.hidden||r.visible||i===!1)&&(e=t?t(r,u,f++):++f,e===!1)))return;n._propCount==null&&(n._propCount=f)}function lu(t,i,r){var u=t._inDataView,e=u.get_isForm(),f;rt(t,function(o,s){var c=o.field,tt=o.expression,v,it,g,a=o.item,ft=a,w,k,p=o.tooltip,nt,rt;if((c||tt)&&r){var y=tt?tt.apply(r,[r]):r[c.Name],et=y==null,l,ht=o.text!==!1,ot=o._label,st=!nt&&ot===!1,ct=c?c.HtmlEncode:!0,d=a.find(".app-value"),lt=a.find(".app-label");et?l=rf:y.getMonth&&ut("ui.smartDates")?(l=n.toSmartDate(y),d.attr({"data-smart-type":c?c.Type:"DateTime","data-smart-value":JSON.stringify(y),"data-title":c?c.format(y):String.format("{0:"+$app.dateFormatStrings["{0:g}"]+"}",y)})):l=c?c.format(y):y.toString();ct?d.text(l):d.html(l);nt=o._grid;d.toggleClass("app-medium",o.medium===!0||o.mediumValue===!0).toggleClass("app-large",o.large===!0||o.largeValue===!0).toggleClass("app-accent",o.accent===!0||o.accentValue===!0).toggleClass("app-nowrap",!nt&&o.wrap===!1).css("color",hi(o.colorValue,r));rt=o._width;rt&&nt?vt(a.addClass("app-cell").toggleClass("app-nowrap",o.wrap===!1),rt):lt.text(ot).toggleClass("app-medium",o.medium===!0||o.mediumLabel===!0).toggleClass("app-large",o.large===!0||o.largeLabel===!0).toggleClass("app-accent",o.accent===!0||o.accentLabel===!0).css("color",hi(o.colorLabel,r));a.toggleClass("app-label-hidden",st).toggleClass("app-null",et).toggleClass("app-medium",o.medium===!0||o.mediumValue===!0||o.mediumLabel===!0).toggleClass("app-large",o.large===!0||o.largeValue===!0||o.largeLabel===!0);(st&&c||p!=null)&&a.attr("data-title",p!=null?p:c.HeaderText);o.density&&a.addClass("app-density-"+o.density);o.align&&a.addClass("app-align-"+o.align);c&&c.Name===">"&&d.attr("data-title",y?yr.Minimize:yr.Maximize);c&&e&&a.css("display",$("#"+t._inDataView._id+' [data-field="'+u._allFields[c.OriginalIndex].Name+'"]').is(":visible")?"":"none")}else ft=v=a.find(".app-button"),it=v.find(".app-text"),g=b(o,"checked"),ht&&(l=o.text),l==null&&(l=s),fr(o)?it.text(l):(f=i[u._id],f||(i[u._id]=f=[]),w=rr(u,h(s),f),w?(v.show().data({obj:o,contextItem:w}),l=w.text,p=w.tooltip,it.text(l)):v.hide()),p==null&&(p=l),k=o.icon||(w?w.icon:null),v.find("i").remove(),k&&n.icon(k,v),v.toggleClass("app-no-icon",k===!1||k==null).toggleClass("app-wide",o.wide===!0),g!==!0&&(typeof g!="function"||!g(r))||n.icon("material-icon-check-circle",v).addClass("app-checked"),o.text===!1&&(v.addClass("app-no-text"),l=null),p!==l&&v.attr("data-title",p);ft.css({"background-color":hi(o.colorBackground,r),color:hi(o.color,r)});o.when&&a.css("display",r&&o.when(r)?"":"none")})}function au(n,t){var r=[],u=[],i;return n._lastResult.primaryKey.forEach(function(n){i=t[n.Name];r[n.Index]=i;u.push(i)}),{row:r,key:u}}function vu(t,i,r){t._lastResult=r;var y=t._inDataView,d={},p,l=i.find(".app-container-content").empty(),e,u=r.pageIndex,f=r.pageSize,s=r.totalRowCount,w=t._expanded,h,a,v=r.letters,k=[],g=b(t,"beginsWithLetter");r.list.forEach(function(n,i){n["#"]=u*f+i+1;h=o("app-item app-feedback").appendTo(l).data({id:y._id,obj:n,config:t});cu(t,h);var r=au(t,n);w&&(a=w[r.key.toString()]===!0,n[">"]=a,a||h.addClass("app-collapsed"));oi(n,y);lu(t,d,n);oi(n);p||t._inDataView.rowIsSelected(r.row)&&(p=!0,h.addClass("app-selected"))});f<s&&(e=o("app-row-pager").appendTo(l).data("config",t),n.icon("material-icon-navigate-before",c("app-btn app-feedback app-prev").appendTo(e).attr("data-title",wi.Previous).toggleClass("app-disabled",!u)),n.icon("material-icon-navigate-next",c("app-btn app-feedback app-next").appendTo(e).attr("data-title",wi.Next).toggleClass("app-disabled",u===Math.ceil(s/f)-1)),c("app-info").appendTo(e).html(String.format(wi.ShowingItems,u*f+1,Math.min(s,(u+1)*f),s)));ci(l);t.letters&&v&&(v.list.forEach(function(n){k.push('<span title="'+n+'"'+(g===n?' class="app-selected"':"")+">"+n+"<\/span> ")}),i.find(".app-letters").html(k.join("")).data("letters",v))}function ci(n){if(n){var r=n.find(".app-selected"),t,i;r.length&&(i=bi(r),t=bi(n),(i.top<t.top||i.bottom>t.bottom)&&n.scrollTop(i.top-t.top+n.scrollTop()-(t.height-i.height)/2))}else $(".app-display .app-row-header+.app-container-content").each(function(){ci($(this))})}function yu(n,t,i){var f=n._inDataView,e=n.letters,u,s=i==null,o=n.loadOnStart;o===!1&&delete n.loadOnStart;i=i||0;e&&(u=b(n,"beginsWithFilter"));r.execute({from:f,as:"list",pageSize:n._count,pageIndex:i,requiresRowCount:!0,_filter:u?[u]:null,sync:s?f._selectedKey:null,requiresData:o==null,letters:e&&i===0}).then(function(i){vu(n,t,i)})}function pu(n){var i=f.data("config"),r={},u={},o={},t,e;typeof i!="string"&&(t=l.children().last(),t&&(e=t.offset().top),i.forEach(function(n,t){var i=n._inDataView,l=st.length,s=s=f.find('.app-container[data-index="'+t+'"]'),a=i._dataViewFieldOwnerId||i._id,h=u[i._id],c,e;(h==null&&(h=u[a]=$("#"+a+".ui-page-active").length>0||!yi("ontop")),h)&&(!l||st.indexOf(i._id)>=0)&&(eu(n)?(c=n._lastResult,n.loadOnStart!==!1||n.letters?!l&&c?vu(n,s,c):yu(n,s):delete n.loadOnStart):(e=r[i._id],e===undefined&&(e=r[i._id]=i.data()),e=i.commandRow()?e:null,n._hasFields&&s.css("display",e?"":"none"),oi(e,i),lu(n,o,e),oi(e)))}),st.splice(0),e!==t.offset().top&&n!==!1&&si())}function wu(n,t){var i=n.css("background-color").match(/^rgba?\((\d+,\s*\d+,\s*\d+)/);i&&n.css("background-color",typeof t=="number"?"rgba("+i[1]+","+t+")":"rgb("+i[1]+")")}function hr(){l&&l.focus()}function bu(){var t=n.screen();t.isVirtual&&u.css({left:t.left,top:t.top,width:t.width,height:t.height})}function li(i){d=null;var f=e.error(),r=f,u,o=t.runOnce;i=r?!1:typeof i=="boolean"?i:!0;t.input.barcode!=null&&(i||(u=t.input.barcode,r=r?u+" > "+r:u));t=null;r!=null&&g(r,!0,f?3e4:null);tt(!1);s.barcode(!0);s.barcode().length||(o?(clearTimeout(vr),n.kiosk()?n.kiosk("focus"):vr=setTimeout(s.focus,200,{lastFocused:!0})):ht({runOnce:!0}))}function ai(){return t.error?(nt()||t.discarding?setTimeout(ai,ft):li(),!1):(t.index++,!0)}function vi(i){var f=r.ifThisThenThat(),h,o,u,s,c;if(i){if(t&&!f.length)return;if(u=n.dataView(),s=i.id,o=nt(),nr(u)!==u&&(fi(!0)?(o=!0,i._notified||(g(ot.Reading,!0,3e4),i._notified=!0)):i.input.barcode&&(g(!1),n.goBack(),o=!0)),u&&u._inlineEditor)if(fi(!0))o=!0;else{u.tag("discard-changes-prompt-none");n.goBack(function(){setTimeout(vi,ft,i)});return}if(o){setTimeout(vi,ft,i);return}t=i;s&&f.every(function(n,i){return n.id===s&&(t.index=i),t.index==null});t.index==null&&(gu=(new Date).getTime(),t.index=0);tt(!0)}else if(!t)return;for(d||(d=$.Deferred(),$.when(d).then(li));t.index<f.length;)if(h=f[t.index],h.background||s&&h.id===s)try{if(t.context=new it,c=h.execute(e,t.context).done(at),t.ifResult===!1){if(!ai())break}else if(t.ifResult==null){c.fail(function(){ai()?vi():li(!1)});break}else break}catch(l){at(l);break}else if(!ai())break;t&&t.index>=f.length&&(li(!1),ht())}function ht(n){n||(n={});var f=n.id||n.input||n.runOnce,i=r.ifThisThenThat._interval,u;n.input||(n.input={});"numpad"in n||(w=cr(w),n.input.numpad=w,String.isNullOrEmpty(w)||(u=parseFloat(w),n.input["numpad.number"]=isNaN(u)?null:u,n.input["numpad.date"]=Date.tryParseFuzzyDate(w),n.input["numpad.time"]=Date.tryParseFuzzyTime(w)));clearTimeout(pi);f?pi=nt()||t?setTimeout(ht,96,n):setTimeout(vi,n.interval||0,n):i&&(n.interval=i,i&&ht(n))}function bf(){var f=r.odp.offline("icon"),u=[],t,i,e;if(n.navContext(u),f)for(t=0;t<u.length;t++)if(i=u[t],i.icon===f){e=!0;break}e?i.callback(i.context):r.alert(yt.ODP.SaveAndSync)}function kf(){g("Not supported.")}function df(){var n=[],t;r.odp.offline()&&(gi.icon=r.odp.offline("icon")||"material-icon-cloud",gi.tooltip=r.odp.offline("tooltip"),n.push(gi));r.host&&n.push(of);u.find("> .app-btn").each(function(i){var u=$(this),r=n[i];i<n.length?(u.data("btn",r).show().attr("data-title",r.tooltip).find("i").css("transform",r.transform||"").text(r.icon.replace("material-icon-","").replace("-","_")),t=u):u.hide()});t&&u.find(".app-logo").css("right",u.width()-t.offset().left)}function gf(){a.one("touchinit.app",function(){y.data("kiosk")&&v("kiosk.enabled",!0);n.kiosk(v("kiosk.enabled"))}).on("pagereadycomplete.app",function(){if(u)if(ui){var i=n.pageInfo();i&&!i.home||t?lt(kt()):a.trigger("ifttt.app")}else er(""),ui=!0;else ui=!0}).on("barcode.app",function(n){if(!n.isDefaultPrevented()&&r.ifThisThenThat().length)return t?s.barcode().push(n.text):ht({input:{barcode:n.text}}),!1}).on("ifttt.app",function(n,t){var i=n.ifThis||t;ht({id:i,runOnce:i==null});ar=!0}).on("vclick",".app-kiosk .app-avatar",function(){return setTimeout(function(){$(".app-bar-toolbar .app-avatar").trigger("vclick")}),!1}).on("vclick",".app-kiosk .app-btn-context",function(){return setTimeout(function(){$(".app-bar-toolbar .app-btn-context").trigger("vclick")}),!1}).on("vclick",".app-kiosk .app-logo",function(){return setTimeout(function(){$(".app-bar-toolbar .app-btn-menu").trigger("vclick")}),!1}).on("vclick",".app-kiosk .app-login",function(){return n.showAccountManager(null,!0),!1}).on("vclick",".app-kiosk .app-button",function(){var t=$(this);return nt()||tt()||(n.callWithFeedback(t),setTimeout(te,0,t)),!1}).on("vclick",".app-kiosk .app-numpad .app-btn, .app-kiosk .app-numpad .app-text i",function(){var t=$(this);return nt()||tt()||(n.callWithFeedback(t),setTimeout(re,0,t)),!1}).on("vclick",".app-kiosk .app-item",function(t){var i=$(this),o=$(t.target).closest('[data-name=">"]'),f,u,r,e;return o.length?(f=i.data("config"),u=i.data("obj"),r=!u[">"],u[">"]=r,f._expanded[au(f,u).key.toString()]=r,i.toggleClass("app-collapsed",!r),e=o.find(".app-value"),e.find("i").text("expand_"+(r?"less":"more")),n.toggleTooltip(e,r)):(n.callWithFeedback(i),nt()||tt()||(i.is(".app-selected")?ci(i.parent()):setTimeout(ne,0,i))),!1}).on("vclick",".app-kiosk .app-tabset .app-text",function(){var n=$(this),r=n.parent().find(".app-text"),t=[n.addClass("app-selected")],i=n.prevAll(".app-text"),u=i.length?i.last():n;return r.each(function(i){var r=$(this);r.is(n)?b(u.data("config"),"selectedTab",i):t.push(r.removeClass("app-selected"))}),t.forEach(function(n,t){var i=!n.prev().length;n.data("tab").forEach(function(r,u){var f=i&&!u?n.parent().nextAll():r;f.toggleClass("app-hidden",!!t)})}),si(),!1}).on("vclick",".app-row-pager .app-btn",function(){var t=$(this);return nt()||tt()||t.is(".app-disabled")||(n.callWithFeedback(t),setTimeout(ie,0,t)),!1}).on("vclick",".app-kiosk .app-letters span",function(){var r=$(this),u=r.parent(),i=u.data("config"),e=u.data("letters"),n,o=b(i,"beginsWithLetter"),t=i._inDataView,f=e.field;return u.find(".app-selected").removeClass("app-selected"),r.addClass("app-selected"),t&&(n=r.text(),n===o&&(n=null),b(i,"beginsWithFilter",n==null?null:f+":$beginswith$%js%"+JSON.stringify(n)),b(i,"beginsWithLetter",n),t.removeFromFilter(f),n==null?t.sync():t.applyFilter(t.findField(f),"$beginswith$",n)),!1}).on("vclick",".app-kiosk > .app-btn",function(){var n=$(this).data("btn");return setTimeout(n.exec),!1}).on("dataviewrefresh.app datainputbroadcast.app",ti).on("themechanged.app",ni).on("useravatarchanged.app",function(){u&&r.AccountManager.avatar(r.userName(),u.find("> .app-avatar i"))});nf.on("throttledresize",ni)}function ne(n){n.parent().find(".app-item").removeClass("app-selected");n.addClass("app-selected");fu(wt(n.data("id")),n.data("obj"),{},{})}function ku(n){var t;return rt(f.data("config"),function(i){return rt(i,function(i,r){if(r===n)return t=i,!1},!1),t?!1:void 0},!1),t}function te(t){var u=t.data("obj"),v=t.data("contextItem"),w=u.barcode,f=u.perform,e,o,c,l,r,i,a,y,p,d;v?v.callback(v.context):(f&&(typeof f=="function"?f(u):(o=f.pick,c=f.show,l=f.hide,o&&(i=k(h({selector:o})),i&&(y=i.Type.match(/^Date/),i=i._dataView._allFields[i.OriginalIndex],(i.ItemsStyle||y)&&(e=!0,s.focus({field:i}),a=$('.ui-page-active [data-field="'+i.Name+'"]'),p=a.find(".app-data-input-button"),y?(d=n.pageInfo(i._dataView).page.addClass("app-page-modal-above-kiosk"),a.trigger("vclick"),setTimeout(g,0,u._label||i.HeaderText,!0),setTimeout(function(){d.removeClass("app-page-modal-above-kiosk")},200)):p.length?p.trigger("vclick"):s.methods.lookup.click($.Event("vclick",{target:a})))),e||g("pick: "+o,!0)),!e&&c&&(r=ku(c),r&&!r.visible&&(r.visible=!0,b(u,"checked",l!=null?!0:null),ni(!0),e=!0)),!e&&l&&(r=ku(l),r&&r.visible&&(r.visible=!1,b(u,"checked",c!=null?!1:null),ni(!0),e=!0)))),w!=null&&s.barcode(w))}function ie(n){var r=n.closest(".app-row-pager"),u=n.closest(".app-container"),t=r.data("config"),i=t._lastResult.pageIndex;yu(t,u,n.is(".app-next")?++i:--i)}function re(n){n=$(n);var f=n.closest(".app-numpad"),i=n.data("key"),e=n.data("test"),t=f.data("text"),u,r,o;t==null&&(t="");u=$.Event("numpadkey.app",{numPad:f,key:i,text:t});a.trigger(u);u.isDefaultPrevented()||(i=u.key,t=u.text,r=t.length,i==="BackSpace"?t.length&&(t=t.substring(0,r-1)):i==="Enter"?r&&(t!==cr(t)?t=cr(t):(s.barcode(t),t="")):i==="PlusMinus"?r<1?t="-":(o=t[r-1],t.match(/\W$/)?t=t.substring(0,r-1)+(o==="+"?"-":"+"):t+="+"):i==="*"?r&&(t.match(/\W$/)?t=t.substring(0,r-1)+"*":t+="*"):i==="abc"||(i==="Clear"?t="":i!=null&&(e==null||di[e](t))&&(t+=i)),du(t))}function cr(n){var u=0,f=/((-|\+).+?)(-|\+|$)/,t,e,r,o=/(\*(.+?))(\*|$)/,i;if(!String.isNullOrEmpty(n)&&n.substring(1).match(/(-|\+|\*)/)){for(n.match(/^(-|\+)/)||(n="+"+n),t=n.match(f);t;){for(r=1,t=t[1],n=n.substring(t.length),e=t[0]==="+"?1:-1,t=t.substring(1),t.match(/^\*/)||(t="*"+t),i=t.match(o);i;)i=i[1],t=t.substring(i.length),i=i.substring(1),r*=Number.parseLocale(i),i=t.match(o);u+=e*r;t=n.match(f)}n=u.toString()}return n}function du(n){n==null&&(n="");w=n.toString();l.find(".app-numpad").data("text",w).find(".app-text").toggleClass("app-null",!w.length).find(".app-value").text(w)}var e,r=$app,n,s,yi,d,t,ft=16,gu,y=$("body"),a=$(document),nf=$(window),ri,ui,pi,lr,ar,u,f,l,et,p,vr,yt=Web.DataViewResources,ot=yt.Mobile,wi=yt.Pager,yr=yt.Form,bi=r.clientRect,tf=r.elementAt,rf=yt.Data.NullValueInForms,uf=/^(tn|xxs|xs|sm|md|lg|xl|xxl)?(_)?(tn|xxs|xs|sm|md|lg|xl|xxl)?$/,ki=["selector","value","regex","inSelector","inRegex","qualifier","_extended"],ff=["as","background","border","hero","icon"],st=[],pt,ut,w,di=[],ef=0,pr={},wt=r.findDataView,gi={exec:bf},of={icon:"line_weight",tooltip:"Scan",transform:"rotate(270deg)",exec:kf},wr,ct=r.html,sf=ct.tag,ue=ct.$tag,o=ct.$div,bt=ct.span,c=ct.$span,br=ct.$i;standardNumPadButtons=[[{key:"7"},{key:"8"},{key:"9"},{key:"BackSpace",icon:"backspace",dark:!0}],[{key:"4"},{key:"5"},{key:"6"},{key:"PlusMinus",text:String.fromCharCode(177),dark:!0}],[{key:"3"},{key:"2"},{key:"1"},{key:"*",dark:!0}],[{key:"0",width:2},{key:function(){return Sys.CultureInfo.CurrentCulture.numberFormat.NumberDecimalSeparator},test:function(n){return!n.match(/(\.|\.\d+)$/)}},{key:"abc",font:"1em",dark:!0}],[{key:"Enter",icon:"keyboard_return",accent:!0}]];it.prototype={deferred:function(n,t){var r=this,i=r._deferred;if(n&&n.match(/^:/))return n=n.substring(1),i.state()===n;if(n==="resolve")i.resolve(t),r._resolvedArgs=t;else if(n==="reject")i.reject(t);else if(n==="pending")r._deferred=$.Deferred();else return i},_generic:function(n,t,i){var r=this,f=r._andNot,u;return r.deferred(":rejected")||(r=new it(r),n=h(n,i),u=t(n,r),u&&u.then?r.pending(u):(f&&(u=!u,r._andNot=!1),u?r.deferred("resolve",u):r.deferred("reject",n))),r},pending:function(n){if(arguments.length)this._pending.push(n);else return this._pending},not:function(){var n=this;return n._andNot=!0,n},page:function(n){return this._generic(n,function(n){var i=Web.Menu.currentNode,t=n.identifier,u,f;if(i){if(u=i.title,t)i.url===r.resolveClientUrl(t)&&(f=!0);else if(u!=null)try{f=u.match(n.regex)}catch(e){}}else if(typeof t=="string")return location.pathname===r.resolveClientUrl(t);return f})},controller:function(n){return this._generic(n,function(n){var i,r=n.identifier,t=gt(n);return t&&(i=r?t._controller===r:t.get_view().Label.match(n.regex)),i})},view:function(n){return this._generic(n,function(n){var i,r=n.identifier,t=gt(n),u=n.selector;return t&&(i=r?t._viewId===r:u.match(/^:/)?t.extension().viewStyle().toLowerCase()===u.substring(1).toLowerCase():t.get_view().Label.match(n.regex)),i})},form:function(){return this.view(":form")},list:function(){return this.not().form()},field:function(n){return this._generic(n,function(n){return k(n)})},action:function(n){n=h(n,arguments,2);var t=this._andNot;return this._generic(n,function(n,i){var r=i.deferred();return ir(n,r,!1,function(i){var r=rr(i,n);return t&&(r=!r),r==null?!1:r}),r.promise()})},input:function(n,i){return n!=null&&(arguments.length<2?i=n.test:n.test=i),!i||i instanceof RegExp||typeof i=="function"||(i=new RegExp(RegExp.escape(i),"i")),this._generic(n,function(n){var r,u=n.selector,f;if(u==="")for(f in t.input){u=f;break}return t&&(r=t.input[u],i&&(typeof i=="function"?r=i(r):r!=null&&typeof r=="string"&&(r=r.match(i)))),r})},barcode:function(n){var t={selector:"barcode"};return arguments.length>0&&(t.test=n),this.input(t)},display:function(n){return this._generic({},function(){return typeof n=="string"&&(n={id:n}),f!=null&&n===f.data("display")})},reading:function(n){return this.not().editing(n)},editing:function(t){return this._generic(t,function(){var t=n.dataView();return t&&t._id!=="-confirm"&&t.get_isForm()&&t.editing()})},inserting:function(t){return this._generic(t,function(){var t=n.dataView();return t&&t._id!=="-confirm"&&t.get_isForm()&&t.inserting()})},val:function(n,t){var r=this,i;return n!=null&&(arguments.length<2?(i=typeof n=="object"&&"test"in n,t=n.test):(n.test=t,i=!0)),r._generic(n,function(n){var r,u=k(n),f;return u&&(f=u._dataView.data(),r=f[u.Name],i&&(t instanceof RegExp?r!=null&&(r=r.toString().match(t)):t==null?r=r==null:typeof t=="function"?r=t(r):retult=r===t)),r})},row:function(n){var i=this._andNot;return this._generic(n,function(n,u){var f=u.deferred();return ir(n,f,!1,function(u,f){var o={},s;if(u){if(o=uu(n,"context:row"),!o)return!1;if(s=t.input[JSON.stringify(o)],s)return s;r.execute({controller:u._controller,view:u._viewId,externalFilter:u.get_externalFilter(),filter:o,odp:!0}).done(function(r){var e=r[u._controller],s=n._extended.mapped?n.qualifier:n.selector,c,h;if(s=s?s+=".":"",e&&e.length){e=e[0];t.input[JSON.stringify(o)]=e;for(c in e)t.input[s+c]=e[c];h=e}i&&(h=!h);h?f.resolve(e):f.reject()}).fail(function(t){e.error("context.row: "+t.get_message()+"\n"+ei(n));at(!1)})}else e.error("context.row: Data view "+(n.in||"")+" is not found."),nu(!1);return f}),f},arguments)},confirm:function(i){return this._generic(i,function(i,u){function e(n){var t=n.text===s;return setTimeout(function(){t?r.action({path:"form/submit"}):history.go(-1)}),!1}var f=u.deferred(),o=i.selector,s=t.context.barcode().unwrap();s&&(o+="\r\n"+ot.ScanToConfirm);a.on("barcodebefore.app",e);return dt(!0),n.whenPageShown(gr),r.confirm(o).then(function(){a.off("barcodebefore.app",e);f.resolve()}).fail(function(){a.off("barcodebefore.app",e);f.reject()}),f})},key:function(n){return typeof n=="string"&&(n={"in":n}),this._generic(n,function(n){var i,r=gt(n),t;return r&&(t=r.get_selectedKey(),t.length&&(i=t.length===1?t[0]:t)),i})},unwrap:function(){var n=this.deferred();return n.state()==="resolved"?this._resolvedArgs:n},toString:function(){return this.unwrap()}};e={"if":function(){function h(){t.context._andNot=null;t.ifResult=!0;e.resolve()}function o(){t.ifResult=!1;e.reject()}var f,n,s,u;t.ifResult=null;var r=!0,e=$.Deferred(),i=[];for(f=0;f<arguments.length;f++)if(n=arguments[f],n instanceof it)if(n.deferred(":rejected")){r=!1;break}else s=n.pending(),s.length&&(i=i.concat(s));else if(n&&n.promise)i.push(n);else if(typeof n=="function"){if(u=n(),u&&u.promise)i.push(u);else if(!u){r=!1;break}}else if(!n){r=!1;break}return r?i.length?$.when.apply($,i).then(function(){for(var n=0;n<i.length;n++)if(i[n].state()!=="resolved"){r=!1;break}r?h():o()}).fail(function(){o()}):h():o(),e.promise()},resolve:function(){return at(),$.when(!0)},reject:function(){return nu(),$.when(!0)},discard:function(i){var r=$(".app-ui-automation-root").attr("id");return t.error=i,t.discarding=!0,e._exec(function(i){function u(){var f=n.dataView(),e;f?f._id===r?(ti({dataView:f}),t.discarding=!1,i.resolve(),d&&d.resolve()):(e=f._parentDataViewId,e&&ti({dataView:wt(e)}),f.get_isForm()&&f.tag("discard-changes-prompt-none"),n.goBack(u)):i.resolve()}return u(),!1})},notify:function(n,t){return n instanceof it&&(n=n.unwrap()),typeof n!="object"&&(n={text:n,force:!0,duration:t}),e._exec(function(){g(n)})},_wait:function(n){n.resolve&&(n={deferred:n,attempts:0});var r=n.deferred,i=fi();if(nt()||i)i&&!n.notified&&(t.confirmed?t.confirmed=!1:s.barcode().length&&(g(ot.Reading,!0,3e4),n.notified=!0)),n.attempts++,setTimeout(e._wait,ft,n);else{n.notified&&g(!1);try{r.resolve()}catch(u){at(u)}}},_exec:function(n){var i=$.Deferred(),r=arguments.length>1&&arguments[0];return r?ir(r,i,!0,arguments[1]):n(i)!==!1&&(t.error?i.reject():setTimeout(e._wait,ft,i)),i.promise()},error:function(n){if(arguments.length)typeof n=="object"&&n.message&&(n=n.message+"\n"+n.stack),typeof n=="string"&&(n={error:n}),t&&(t.error=n.error);else return t.error},action:function(n){return n=h(n,arguments,2),e._exec(n,function(t){var i=rr(t,n),r=i&&i.callback;r?r(i.context):e.error('app.action: "'+n.selector+'" is not available in the context'+(n.in?' "'+n.in+'"':"")+".")})},_countBarcodes:function(n){var r=1,t;if(n!=null){for(n instanceof it&&(n=n.unwrap()),t=s.barcode(),i=0;i<t.length&&t[i++]===n;)r++;t.splice(0,r-1)}return r},inc:function(n,t){n=h(n);var r=k(n),u,i,f=n._method||"inc";if(r)return u=r._dataView.data(),n=r.Name,i=u[n],i==null&&(i=0),i+=e._countBarcodes(t)*(f==="inc"?1:-1),e.val(n,i);e.error("app."+f+": Failed to change "+ei(n))},dec:function(n){return arguments[0]=n=h(n),n._method="dec",e.inc.apply(e,arguments)},val:function(n){return n=h(n,arguments),delete n.in,e._exec(function(t){function y(n,t,i){n.map[t]=i;n.reverseMap[i]=t;a[t]=n}function p(n){s.execute(i);n!==!1&&t.resolve(i)}var o=k(n),c,l,i=[],u=[],a={},v=[],f;if(o){if(l=o._dataView,n._extended.mapped)for(f in n)ki.indexOf(f)<0&&(c=k(h({selector:f})),c?i.push({field:c,value:n[f]}):u.push('"'+f+'"'));else i.push({field:o,value:n.value});if(i.forEach(function(n){n.value instanceof it&&$.when(n.value.deferred()).done(function(t){n.value=t})}),!u.length){if(l._allFields.forEach(function(n){if(n.ItemsStyle&&n.ItemsDataController){var i={field:n,map:{},reverseMap:{}},u=n.Copy,t,f=r._fieldMapRegex;if(y(i,n.Name,n.ItemsDataValueField),y(i,l._allFields[n.AliasIndex].Name,n.ItemsDataTextField),u)for(t=f.exec(u);t;)y(i,t[1],t[2]),t=f.exec(u)}}),i.forEach(function(n){var u=a[n.field.Name],o,s,h,c={},f,l;u&&!u.pending&&(o=u.field,s=o.ItemsDataController,ItemsDataView=o.ItemsDataView,i.forEach(function(n){a[n.field.Name]===u&&(c[u.map[n.field.Name]]=n.value)}),f={controller:s,filter:c,odp:!0},h&&(f.view=h),l=ei(f),u.pending=r.execute(f).done(function(n){var r=n[s],f;if(r&&r.length)for(f in u.reverseMap)i.push({field:u.reverseMap[f],value:r[0][f]});else e.error("app.val: failed to lookup \n"+l),t.reject(i)}),v.push(u.pending))}),v.length)return $.when.apply($,v).done(p).fail(function(n){i.forEach(function(n){var t=n.field.Name;t&&(n.field=t)});e.error("app.val: failed to lookup - "+n.get_message()+"\n"+ei(i));t.reject(i)}),!1;p(!1)}}else u.push('"'+n.selector+'"');u.length&&e.error("app.val: "+u.join(", ")+" not found.")})},focus:function(n,t){return n=h(n),arguments.length>1?n.message=t:t=n.message,e._exec(function(){var i=k(n);i?(i=i._dataView._allFields[i.OriginalIndex],i.Type!=="DataView"&&dt(!0),s.focus({field:i,message:t}),dt()):e.error("app.focus: field "+n.selector+" not found.")})},confirm:function(i){var u=t.context.barcode().unwrap(),o,f;if(u&&(f=s.barcode(),f.length))for(o=!0;f[0]===u;)f.splice(0,1);return e._exec(function(f){function s(i){var f=i.text===u;return t.confirmed=!0,setTimeout(function(){n.isInTransition()||(f?r.action({path:"form/submit"}):history.go(-1))}),!1}if(o)return!0;if(dt(!0),n.whenPageShown(gr),u){a.on("barcodebefore.app",s);i+="\n\n"+ot.ScanToConfirm}return r.confirm(i).then(function(){a.off("barcodebefore.app",s);f.resolve(i)}).fail(function(){a.off("barcodebefore.app",s);e.resolve();f.reject(i)}),!1})},row:function(n){return n=h(n,arguments),e._exec(function(){function l(){s.focus({field:o})}var c=n._extended,u=c.method||"row",v=u==="filter",f=uu(n,u),i,o,h,r;if(!f)return!1;if(h=JSON.stringify(f),r=t.input[h],!r&&v&&(r={}),r){if(i=gt(n),i&&(fu(i,r,f,c),o=i._dataViewFieldName,o))if(i._busy())a.one("dataviewrefresh.app",l);else l();return i}e.error("app."+u+": This method requires a data row in the input.\n Specify 'app.if(context.row("+h+"))' in the activity. Use the same filter when invoking '"+u+"' method.")})},rowFilter:function(n){return n=h(n,arguments),n._extended.method="rowFilter",n._extended.filter=!0,this.row(n)},filter:function(n){return n=h(n,arguments),n._extended.method="filter",n._extended.filter=!0,this.row(n)},input:function(n,i){var r=n,f,e;r==null&&(r={});typeof n!="object"&&(r={},r[n]=i);for(f in r)e=r[f],t.input[f]=e,f==="numpad"&&u&&du(e)},display:function(t){function i(){r.resolve()}function s(n){e.error("app.display: "+n);r.reject()}var r=$.Deferred(),o,h;return arguments.length?f&&t===f.data("display")?f.is(":visible")?i():f.fadeIn("fast",i):(h=u!=null,v("kiosk.enabled")!==!1?(n.kiosk(!0),f.empty().data("display",t),o=er(t),h?(f.hide(),f.fadeIn("fast")):(u.hide(),u.fadeIn("fast")),o?s(o):i()):i()):s("Missing display configuration."),r.promise()},page:function(n){function u(f){f.every(function(f){var e=f.title;if(i)f.url===r.resolveClientUrl(i)&&(t=f);else if(e!=null)try{e.match(n.regex)&&(t=f)}catch(o){}return!t&&f.children&&u(f.children),!t})}var i=n.identifier,t;return n=h(n),i=n.identifier,u(Web.Menu.nodes),t&&t.url&&(location.href=t.url),t}};r.display=function(t){function c(){var a=i.scrollTop(),s=(e!=null||o!=null)&&a>0,f,c,v,h,l;s&&(f=tf(i.offset().left+i.width()/2,i.offset().top+32).closest(".app-container,.app-row-container,.app-sticky-hero-container").first(),f.length&&(f.is(".app-container")||(f=f.find(".app-container").first()),f.length&&(c=f.attr("data-index"),v=f.offset().top-i.offset().top)));h=[];l=[];u.find(".app-container-selected").each(function(){h.push($(this).attr("data-index"))});u.find(".app-container-cut").each(function(){l.push($(this).attr("data-index"))});su(t.flow,i,u.empty(),null,n.toWidth(p[et]));s&&(c&&(f=u.find('.app-container[data-index="'+c+'"]'),f.length&&(i.scrollTop(f.offset().top-i.offset().top-v),s=!1)),s&&i.scrollTop(a));si(i,u,!0);h.forEach(function(n){u.find('.app-container[data-index="'+n+'"]').addClass("app-container-selected")});l.forEach(function(n){u.find('.app-container[data-index="'+n+'"]').addClass("app-container-cut")});h.length&&r.display.designer.selectionChanged()}if(arguments.length||(t=[{flow:"row",content:".app-page-content > *"}]),t==="designer")r.getScript("~/js/daf/touch-flow",function(){r.display.designer.attach()});else if(Array.isArray(t))a.one("displayflow.app",function(n){var e;typeof t=="string"&&(t=[{content:t}]);var i=n.page,r=n.content,u={},f={flow:t};wr=i.attr("id");t.forEach(function(n){var r=n.content,t;r!=null&&(n.isContent=!0,r.match(/^(#|\.)[\w-]+/)&&(t=u[r],t==null&&(t=[],i.find(r).each(function(){t.push(this.innerHTML)}),t=u[r]=t.join("")),n.content=t));n.hero&&(f.trackHeight=!0)});e=r.data("displayFlow",f).find(".app-page-content").addClass("app-display-flow");e.attr("data-editable")&&r.data("originalFlow",JSON.stringify(t))});else{var i=$(t),u,s,h=n.screen().height,e,o,f;t=t.data("displayFlow");t&&(s=n.toWidth(i.width()),u=i.find(".app-page-content"),et=Math.min(p.indexOf(y.data("content-width")||n.settings("ui.content.width")||"xl"),p.indexOf(s)),f=arguments[1],Array.isArray(f)?(t.flow=JSON.parse(JSON.stringify(f)),t.trackHeight=!1,f.every(function(n){var i=n.hero;return i&&(t.trackHeight=!0),!i})):(e=t.breakpoint,o=t.lastHeight),(e!==et||o!==h)&&(t.breakpoint=et,t.lastHeight=h,c()))}};r.display.as={code:{render:function(n,t,i){var a=n.content,v,y=[],e,s,p,f,h,l,u;if(typeof t=="string"&&(t={type:t}),f=o("app-caption").appendTo(i),c("app-type").text({html:"HTML",js:"JavaScript",javascript:"JavaScript",css:"CSS",xml:"XML","c#":"C#",csharp:"C#",vb:"Visual Basic",visualbasic:"Visual Basic"}[t.type]||t.type).appendTo(f),n._header1&&c("app-text").text(n._header1).appendTo(f),$(a).appendTo(i.addClass("app-render-as-code")),h=i.find("code").first(),u=t.type,u.match(/javascript/i)?u="text/javascript":u.match(/c#|csharp/i)?u="text/x-csharp":u.match(/html/i)&&(u={name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null}]}),v=h.text(),typeof CodeMirror=="undefined"){for(e=1;e<=(a.match(/\n/g)||"").length+1;e++)y.push('<div class="app-line">'+e+"<\/div>");s=o("app-gutter").html(y.join("")).appendTo(h);s.width(s.width()+1);p=bi(s);h.css("padding-left",Math.floor(p.width)+4)}r.getScript("~/js/lib/codemirror.min.js",{also:"~/js/lib/codemirror.min.css",then:function(){f.detach();l=o().appendTo(i.empty());f.insertBefore(l);CodeMirror(l[0],{lineNumbers:!0,tabSize:4,matchBrackets:!0,readOnly:!0,mode:u,scrollbarStyle:null,value:v})}})}}};yi=function(){var p=arguments,t,h,i=p[0],r,e,w,c,a;if(p.length&&v("kiosk.enabled")!==!1)if(r=i,e=typeof r=="number"&&r>0&&r<=1?r:!1,e!==!1&&(r=!0),typeof r=="boolean")i?(u||(lt(!0),w=!0,u=o("app-kiosk").attr("tabindex",0).toggleClass("app-fullscreen",v("kiosk.fullscreen")===!0),bu(),c=v("kiosk.density"),c&&u.addClass("app-density-"+c),a=dr(),a.length?u.insertAfter(a):u.appendTo(y),hf(),y.addClass("app-is-kiosk")),e!==!1&&wu(u,e),hr(),ar&&w&&!tt()&&ht({runOnce:!0})):u&&(lt(!1),u.remove(),u=null,f=null,l=null,_displayId=null,y.removeClass("app-is-kiosk"),n.resetUI(),$(".ui-page-active .app-wrapper").focus(),s.focus({lastFocused:!0}));else if(typeof i=="string"&&u){if(i==="get")return!ui||y.is(".app-ui-automation:not(.app-ui-automation-system)")?u:null;if(i==="ontop")return kt();i==="focus"?(t=kt(),t||(h=n.pageInfo(),h&&h.home&&(t=!0)),t&&hr()):i==="refresh"&&df()}return t==null&&(t=u!=null),t};a.on("beforetouchinit.app",function(){n=r.touch;s=r.input;n.kiosk=yi;ut=n.settings;p=n.toWidth();n&&v("enabled")===!0&&gf()})})();