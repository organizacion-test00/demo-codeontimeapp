/*!
* Data Aquarium Framework - Display Flow for Touch UI
* Copyright 2021 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function ft(n){return JSON.parse(JSON.stringify(n))}function et(n){return v(n).data("displayFlow")}function at(n){n=$(n);var t=n.data("index"),i=et(n);return i.flow[t]}function p(n){e.notify({force:!0,text:n})}function tt(){return e.activePage(".app-display-flow-designer")}function r(n){return arguments.length||(n=".app-container"),typeof n=="number"?r('.app-container[data-index="'+n+'"]'):e.activePage(".app-display-flow-designer "+n)}function u(){return r(".app-container-selected")}function y(){return r(".app-container-cut")}function h(t,i){if(t=t.first(),t.length){var r=e.screen(),u={left:r.left,top:r.top,right:r.left+r.width-1,bottom:r.top+r.height-1};if(!i&&w.intersect(s(t),u))return;e.makeVisible(t.first(),null,null,null,null,t.is(".app-container")?n.outerHeight:null)}return t}function ot(){var n=$(document.activeElement);return n.is(":input")?n:null}function vt(){var n=ot();if(n)return n.blur(),v().focus(),!0}function it(){var n=u().length;t.selectionChanged();n>1?p(String.format(lt.ItemsSelectedMany,n)):p(!1)}function st(){return n.top.find(".app-btn-flow-row:visible,.app-btn-flow-column:visible,.app-btn-flow-merge:visible")}function ht(){st().trigger("vclick")}function o(t,i,r){var f,u;u=t==="top"?n.top:n.bottom;u.is(":empty")&&nt("app-btn-separator").appendTo(u);r=r||i;f=e.icon("material-icon-"+r,nt("app-btn app-btn-"+i).appendTo(u)).attr("data-title",{drag:"Drag",settings:"Settings (F4)",edit:"Edit (F2)",cut:"Cut (Ctrl+X)","delete":"Delete (Del)",copy:"Copy (Ctrl+C)","insert-before":"Insert Before","insert-after":"Insert After","paste-before":"Paste Before (Ctrl+V)","paste-after":"Paste After (Ctrl+Shift+V)","flow-row":"Flow as Row","flow-column":"Flow as Column","flow-merge":"Merge With Flow"}[i]);r.match(/call_(merge)/)&&f.css("transform","rotate(180deg)");nt("app-btn-separator").appendTo(u)}function a(t,i,r){n&&(r?r.find(".app-btn-"+t).toggleClass("app-hidden",!i):(a(t,i,n.top),a(t,i,n.bottom)))}function l(){var ht;g=!1;var t=u(),d=tt(),nt=t.first(),r=v(),p=s(r),h=r.scrollTop(),c,w,k,et,it,ot,rt,ft,st=e.screen(),i;if(t.length){if(n||(n={top:ut("app-display-flow-toolbar app-display-flow-toolbar-top").appendTo(r),bottom:ut("app-display-flow-toolbar app-display-flow-toolbar-bottom").appendTo(r)},o("top","drag","drag_indicator"),o("top","flow-row","arrow_downward"),o("top","flow-column","arrow_forward"),o("top","flow-merge","call_merge"),o("top","settings"),o("top","edit"),o("top","cut","content_cut"),o("top","copy","content_copy"),o("top","delete","delete_outline"),o("top","insert-before","add"),o("top","paste-before","content_paste"),n.height=s(n.top).height,n.margin=3,n.outerHeight=n.height+n.margin,o("bottom","drag","drag_indicator"),o("bottom","insert-after","add"),o("bottom","paste-after","content_paste")),h+s(nt).top-n.outerHeight<=p.top)d.css("padding-top",n.outerHeight);else if(parseInt(d[0].style.paddingTop||"0")&&h+s(nt).top-n.outerHeight*2>p.top){r.scrollTop(h-n.outerHeight);d.css("padding-top","");setTimeout(l,32);return}rt=!t.first().is(".app-container-cut")&&y().length||b.length;a("paste-before",rt);a("paste-after",rt);a("cut",t.filter(":not(.app-container-cut)").length);ft=t.length===1;a("edit",ft);a("settings",ft);t.length===1&&(i=f[nt.data("index")]);a("flow-row",i&&i.flow==="row");a("flow-column",i&&i.flow==="column");a("flow-merge",i&&(i.flow||"merge")==="merge");c=s(t);k=s(n.top.show());it=k.width>c.width?Math.floor((k.width-c.width)/2):0;w=s($(t[t.length-1]).show());et=s(n.bottom.show());ot=it?Math.floor((et.width-w.width)/2):0;n.top.data("selection",t).css({left:Math.max(0,c.left-2-st.left-it),top:c.top-k.height-n.margin+h-p.top});n.bottom.css({left:Math.max(0,w.left-2-st.left-ot),top:w.bottom+n.margin+h-p.top})}else n&&(tt().css("padding-top",""),n.top.hide(),n.bottom.hide());v().focus();ht=[];e.navContext(ht)}function ct(n){for(var t=n.attr("class").match(/\bapp-btn-([\w\-]+)/)[1],i=t.indexOf("-");i>0;)t=t.substring(0,i)+t.charAt(i+1).toUpperCase()+t.substring(i+2),i=t.indexOf("-");return t}var w=$app,e=w.touch,t,lt=Web.DataViewResources.Mobile,k=$(document),d,g,n,s=w.clientRect,v=e.scrollable,i=[],b=[],f,rt,c=w.html,yt=c.tag,pt=c.div,wt=c.span,bt=c.$tag,kt=c.$p,ut=c.$div,nt=c.$span,dt=c.$a,gt=c.$i,ni=c.$li,ti=c.$ul;t=w.display.designer={attach:function(){var n=v();f||(f=JSON.parse(n.data("originalFlow")));e.activePage(".app-display-flow").addClass("app-display-flow-designer")},selectionChanged:function(){var n=et();n&&k.trigger($.Event("displaydesignerselectionchanged.app",{flow:n.flow,selection:u()}))},saveState:function(n){i.position!=null&&i.splice(i.position);n||(n=[],u().each(function(){n.push($(this).data("index"))}));i.push({selection:n,time:new Date,flow:JSON.stringify(f)});delete i.position},undo:function(){i.length&&(i.position==null&&(t.saveState(),i.position=i.length-1),i.position&&t.restorePageFlow(i[--i.position]))},redo:function(){i.position>=0&&i.position<i.length-1&&t.restorePageFlow(i[++i.position])},restorePageFlow:function(n){f=JSON.parse(n.flow);u().removeClass("app-container-selected");y().removeClass("app-container-cut");t.refreshPageFlow(n.selection)},refreshPageFlow:function(n){w.display(v(),f);n==null||Array.isArray(n)||(n=[n]);n&&n.length&&(n.forEach(function(n){r(n).addClass("app-container-selected")}),h(r(n[0])));l()},cut:function(){b=[];y().removeClass("app-container-cut");var n=u().addClass("app-container-cut").removeClass("app-container-selected");l();p(n.length>1?String.format("Select a container and paste {0} items before or after.",n.length):"Select a container and paste the item before or after.")},copy:function(){b=[];y().removeClass("app-container-cut");var n=u().each(function(){b.push(ft(f[$(this).data("index")]))});p(String.format("Copied {0} items.",n.length));l()},paste:function(n){var e=u(),o=[],k=[],g=e.first().data("index"),s=e.last().data("index"),d,i,c,a=b.length;if(!a&&(e.first().is(".app-container-cut")||!y().length)){p("Paste is not allowed here.");return}for(a||(c=[],y().each(function(){c.push($(this).data("index"))})),t.saveState(c),d=f[n?s:g],a?o=ft(b):(y().each(function(){var n=$(this).data("index");o.push(f[n]);k.push(n)}).removeClass("app-container-cut"),k.reverse().forEach(function(n){f.splice(n,1)})),i=f.indexOf(d),o.reverse().forEach(function(t){f.splice(i+(n?1:0),0,t)}),e.removeClass("app-container-selected"),w.display(v(),f),t.refreshPageFlow(),n&&i++,s=i+o.length-1,h(r(i));i<=s;)r(i++).addClass("app-container-selected");l()},pasteAfter:function(){t.paste(!0)},pasteBefore:function(){t.paste()},"delete":function(){var i=u(),n=i.first().data("index");t.saveState();f.splice(n,i.length);n==f.length-1&&srartIndex--;t.refreshPageFlow(n)},flow:function(){function c(i){t.saveState();i==="merge"?delete n.flow:n.flow=i;t.refreshPageFlow(o)}var a=u(),o=a.data("index"),n=f[o],l=st(),i;h(r(o));i=s(l);e.listPopup({anchor:l,x:i.left+i.width/2,y:i.bottom,y2:i.top,items:[{text:"Flow as Row",icon:"material-icon-arrow-downward",focus:n.flow==="row",context:"row",callback:c},{text:"Merge With Flow",icon:"material-icon-call-merge",rotate:180,focus:(n.flow||"merge")==="merge",context:"merge",callback:c},{text:"Flow as Column",icon:"material-icon-arrow-forward",focus:n.flow==="column",context:"column",callback:c}]})},flowRow:function(){t.flow()},flowColumn:function(){t.flow()},flowMerge:function(){t.flow()},settings:function(){var t=u().first(),i=t.data("index"),r=f[i],n=[];n.push("display.flow");n.push("display.appearance");n.push("appbuilder.settings");e.propGrid("show",{target:r,propSet:rt,use:n,context:"display-flow",helpUrl:"https://codeontime.com/docs",location:s(t).left>=e.screen().left+e.screen().width/2?"left":"right"})}};k.on("mousedown vclick",".app-display-flow-designer .app-container",function(n){var t=$(this),o=t.data("index"),h=at(t),s,i,f,c;if(h&&!h.readOnly){if(n.type==="mousedown"){if(e.pointer("touch"))return;$.touch.skipMouseEnd=!0}return t.is(".app-container-selected")&&!n.ctrlKey&&!n.shiftKey&&u().length===1?void 0:(n.ctrlKey?t.toggleClass("app-container-selected",!t.is(".app-container-selected")):(n.shiftKey?(s=u(),s.length&&(i=s.first().data("index"),f=s.last().data("index"),o<i?i=o:f=o)):t.is(".app-container-cut")&&!r(".app-container-cut.app-container-selected").length?c=!0:i=f=o,u().removeClass("app-container-selected"),c?y().addClass("app-container-selected"):i===f?t.addClass("app-container-selected"):r().each(function(){var n=$(this),t=n.data("index");i<=t&&t<=f&&n.addClass("app-container-selected")})),it(),!1)}p("This display object is read-only.")}).on("vclick","article",function(){var n=u().removeClass("app-container-selected app-container-cut");n.length&&(t.selectionChanged(),p(!1),r().css("padding-top",""))}).on("keydown",".app-wrapper",function(n){if(tt().length){var i=u(),f=n.key,c=n.shiftKey,p=n.ctrlKey,e=y(),a,w,o;if(f==="z"&&p)return setTimeout(t.undo()),!1;if(f==="y"&&p)return t.redo(),!1;if(i.length||f==="Tab"){if(f==="Tab"){if(i.length){if(a=!0,w=s(v()),i.each(function(){var n=s(this);return w.top<n.bottom&&n.top<w.bottom&&(a=!1),a}),a)return h(i.first()),!1;i.removeClass("app-container-selected")}else i=e.length?e.first():c?r().first():r().last();return i=c?i.first():i.last(),o=i.data("index"),c?o--:o++,i=r(o),i.length||(i=o>=0?r().first():r().last()),i.addClass("app-container-selected"),l(),h(i),!1}if(f==="Escape")return vt()||(e.length&&e.first().is(".app-container-selected")?h(e.removeClass("app-container-cut")):h(i.removeClass("app-container-selected")),l()),!1;if(f.match(/^Arrow(Down|Up|Left|Right)$/)&&!ot()){if(c)return f.match(/^Arrow(Down|Right)$/)?h(r(i=i.last().data("index")+1).addClass("app-container-selected")):h(r(i=i.first().data("index")-1).addClass("app-container-selected")),it(),!1;if(p&&i.length>1)return f.match(/^Arrow(Down|Right)$/)?(i.first().removeClass("app-container-selected"),h(u().first())):(i.last().removeClass("app-container-selected"),h(u().last())),it(),!1;if(n.altKey&&f==="ArrowDown"&&i.length===1)return ht(),!1}}else if(f==="Escape"&&!i.length&&e.length)return e.addClass("app-container-selected"),l(),h(e),!1}}).on("displaydesignerselectionchanged.app",function(){if(d){k.one("resized.app",l);g=!0}else l()}).on("resizing.app",function(){n&&(n.top.hide(),n.bottom.hide());d=!0}).on("resized.app",function(){g||l();d=!1}).on("vclick",".app-display-flow-toolbar .app-btn",function(){var i=$(this),n=ct(i);return t[n]?t[n](i):p(n),!1}).on("context.app",function(r){var o=v().data("displayFlow"),u=4,f,e;o&&(r.context.splice(0,0,{text:"Display Flow"},{text:"Undo",icon:"material-icon-undo",toolbar:!1,disabled:!i.length||i.position===0,callback:t.undo,shortcut:"Ctrl+Z"},{text:"Redo",icon:"material-icon-redo",toolbar:!1,disabled:i.position==null||i.position>i.length-2,callback:t.redo,shortcut:"Ctrl+Y"},{},{}),n&&n.top.is(":visible")&&$.merge(n.top,n.bottom).find(".app-btn:visible").each(function(){var h=$(this),n=ct(h),c=h.find(".app-icon"),i=c.data("title"),o=i.match(/\((.+?)\)/),l=c.text(),s=t[n];n.match(/^flow\-/)&&(s=ht);o&&(i=i.substring(0,o.index-1));n!=="drag"&&(n.match(/^(cut|copy)$/)&&!f&&(r.context.splice(u++,0,{}),f=!0),n.match(/Before/)&&!e&&(r.context.splice(u++,0,{}),e=!0),r.context.splice(u++,0,{text:i,icon:"material-icon-"+l,shortcut:o?o[1]:null,toolbar:!1,callback:s||function(){},disabled:!s}))}))});window.addEventListener("beforeunload",function(n){!i.length||i.position===0||(n.preventDefault(),n.returnValue="")});rt={displayFlow:{scope:"display.flow",description:"Defines the flow and style of the rendering.",properties:{flow:{values:[{value:"row",text:"Flow as Row"},{value:"merge",text:"Merge With Flow"},{value:"column",text:"Flow as Column"}]},jumbo:{type:"bool",style:"DropDownList"},spacing:{type:"bool"},icon:{length:50},background:{properties:{fluid:{type:"bool"},accent:{type:"bool"}}},hero:{properties:{about:{},id:{},background:{properties:{url:{},accent:{type:"bool"},sticky:{type:"bool"}}}}}}},appearance:{scope:"display.appearance",description:"Specify the visual aspects of the element.",properties:{hello:{description:"This is the test property. It has a long description that will not fit into the default height. "},world:{type:"bool",description:"The world is full of wonders! How do we know it?"}}},presentation:{scope:"appbuilder.settings",descripton:"Visual aspects of the app.",properties:{splash:{description:"",properties:{enabled:{type:"bool"}}},ui:{text:"User Interface",description:"",properties:{"native":{type:"bool"},menu:{properties:{apps:{text:'"Apps" Button',properties:{location:{values:["none","toolbar","sidebar"]}}},location:{values:["toolbar","sidebar"]}}},themes:{properties:{icons:{values:["filled","outlined","sharp","rounded"]}}},keyboard:{properties:{touchOnly:{type:"bool"},number:{properties:{enabled:{type:"bool"},width:{type:"number"}}},tel:{properties:{enabled:{type:"bool"},width:{type:"number"}}}}},inlineEditing:{properties:{enabled:{type:"bool"},position:{values:["auto","top","inline"]}}},grid:{properties:{lines:{properties:{horizontal:{type:"bool"},vertical:{type:"bool"}}}}},readingPane:{properties:{enabled:{type:"bool"},background:{},detail:{properties:{actionIcons:{type:"bool"}}}}},settings:{text:"Settings",description:"Configuration of the Settings menu in the user interface of the app.",properties:{enabled:{type:"bool",description:"Specifies if the Settings option is avaialble in the user interface of the app."},options:{description:"Sepcifies the configuraton options available to the end user in the Settings menu of the app.",properties:{sidebar:{type:"bool",description:"Specifies if the Sidebar option is visibile in the Settings menu of the app."},displayDensity:{type:"bool",description:"Specifies if the Display Density option is visibile in the Settings menu of the app."},theme:{type:"bool"},transitions:{type:"bool"},labelsInList:{type:"bool"},showSystemButtons:{type:"bool"},promoteActions:{type:"bool"},smartDates:{type:"bool"},initialListMode:{type:"bool"}}}}}}}}},clientApp:{scope:"appbuilder.settings",description:"Configuration properties of the app running on the end user device.",properties:{appName:{description:"The name of this app."},barcode:{properties:{enabled:{type:"bool"}}},dates:{text:"Dates",properties:{localTime:{properties:{enabled:{type:"bool"}}}}}}},serverApp:{scope:"appbuilder.settings",properties:{server:{properties:{rest:{text:"REST",properties:{enabled:{type:"bool"},key:{},accessTokenDuration:{type:"number"},refreshTokenDuration:{type:"number"}}},geocoding:{description:"Geocoding makes possible real-time verification of postal addresses and conversion of addresses into latitude and longitude.",properties:{google:{description:"Geocoding configuration options for Google Maps API. Enables verification of the postal addresses and optional conversion into geo locations. *** The valid Goole Maps API key is required to perform Geocoding requests. Sign into your Google management console to get the key.",properties:{key:{description:"A valid Goole Maps API key is required to perform geocoding requests. Sign into your Google management console to get a key."},address:{type:"bool",description:"Specifies if the automatic address verification with Google Maps API is enabled."}}}}}}}}}}})();